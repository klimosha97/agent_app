---
alwaysApply: true
---

# Правила проекта Football Stats

## 1. Правило загрузки данных из XLSX

**Точное соответствие данных:**
- Все данные из загруженного XLSX файла должны быть сохранены в базу данных `players_stats_raw` БЕЗ ИЗМЕНЕНИЙ
- Все параметры в базе данных должны ПОЛНОСТЬЮ СОВПАДАТЬ с исходным документом
- Данные хранятся "как есть", округление применяется только при отображении

## 2. Правило отображения чисел с плавающей точкой

**При отображении (не при хранении!) применяется округление:**

### Общие числа (кроме xG):
Округляются до ближайшего значения с шагом 0.5:
- `1.2` → `1.0` (отображается как `1`)
- `1.3` → `1.5` (отображается как `1.5`)
- `1.7` → `1.5` (отображается как `1.5`)
- `2.8` → `3.0` (отображается как `3`)
- `0.4` → `0.5` (отображается как `0.5`)
- `0.6` → `0.5` (отображается как `0.5`)

### Параметр xG (исключение):
Всегда отображается с двумя цифрами после запятой БЕЗ округления до 0.5:
- `3.82` → `3.82`
- `12.31` → `12.31`
- `0.67` → `0.67`

### Целые числа:
Отображаются без дробной части:
- `5` → `5`
- `100` → `100`

### Проценты:
Округляются до ближайшего значения с шагом 0.5 (как общие числа):
- `53.2` → `53.0%` (отображается как `53%`)
- `53.3` → `53.5%`
- `53.85` → `54.0%` (отображается как `54%`)
- `100.0` → `100%`

## 3. Идентификаторы турниров и допустимые файлы

**Строгое соответствие файлов турнирам:**

| Tournament ID | Название | Допустимый файл | Другие файлы |
|---------------|----------|-----------------|--------------|
| `0` | МФЛ | `mfl.xlsx` | ❌ ЗАПРЕЩЕНЫ |
| `1` | ЮФЛ-1 | `yfl1.xlsx` | ❌ ЗАПРЕЩЕНЫ |
| `2` | ЮФЛ-2 | `yfl2.xlsx` | ❌ ЗАПРЕЩЕНЫ |
| `3` | ЮФЛ-3 | `yfl3.xlsx` | ❌ ЗАПРЕЩЕНЫ |

**Валидация при загрузке:**
- Система проверяет соответствие имени файла и `tournament_id`
- При несоответствии возвращается ошибка на русском языке
- Файл удаляется если не прошел валидацию

## 4. Правило отображения в таблице База данных

**Все данные из `players_stats_raw` отображаются:**
- Числа с плавающей точкой: округление до 0.5 (кроме xG - 2 цифры)
- NULL значения: прочерк `—`
- Проценты: округление до 0.5 с символом `%`

## 5. Сортировка с NULL значениями

**NULL всегда в конце:**
- При сортировке по возрастанию (ASC): NULL в конце
- При сортировке по убыванию (DESC): NULL в конце
- Использует SQL: `ORDER BY column ASC/DESC NULLS LAST`

## 6. Обработка NaN при импорте

**Защита от NaN значений:**
- Все `NaN`, `Inf`, `-Inf` заменяются на `NULL` при импорте
- Тройная защита: на уровне DataFrame, при очистке, при вставке
- В базе данных НЕ должно быть NaN значений
